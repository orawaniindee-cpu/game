<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Bird for iPad</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            /* ป้องกันการเลือก text เวลาแตะรัวๆ บน iPad */
            -webkit-user-select: none;
            user-select: none;
        }

        .background {
            height: 100vh;
            width: 100vw;
            background-color: skyblue;
            background-size: cover;
            overflow: hidden;
            position: relative;
        }

        .bird {
            height: 50px;
            width: 60px;
            background-color: yellow;
            border: 2px solid black;
            border-radius: 50%;
            position: fixed;
            top: 40vh;
            left: 30vw; /* ขยับมากลางๆ หน่อยสำหรับจอมือถือ/iPad */
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s; /* เพิ่ม animation เวลาบิน */
        }

        .bird::after {
            content: "";
            width: 15px;
            height: 15px;
            background: white;
            border-radius: 50%;
            border: 2px solid black;
            position: absolute;
            top: 5px;
            right: 10px;
        }
        .bird::before {
            content: "";
            width: 20px;
            height: 10px;
            background: orange;
            position: absolute;
            top: 25px;
            right: -5px;
            border: 1px solid black;
        }

        .message {
            position: absolute;
            z-index: 10;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 2rem;
            color: black;
            background: rgba(255, 255, 255, 0.8);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
        }

        .score_val {
            position: fixed;
            top: 40px; /* ขยับลงมาหน่อยเผื่อติดขอบจอ iPad */
            left: 20px;
            font-size: 2rem;
            color: white;
            z-index: 100;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        .pipe_sprite {
            position: fixed;
            top: 0;
            width: 15vw; /* ปรับท่อให้กว้างขึ้นหน่อยสำหรับจอสัมผัส */
            max-width: 80px;
            background: radial-gradient(lightgreen 50%, green);
            border: 3px solid black;
            z-index: 1;
        }
    </style>
</head>
<body>

    <div class="background">
        <div class="score_val">Score: 0</div>
        <div class="message">
            Tap Screen <br> to Start Game
        </div>
        <div class="bird"></div>
    </div>

    <script>
        // --- Game Variables ---
        let move_speed = 3; 
        let gravity = 0.5;
        let bird = document.querySelector('.bird');
        
        let bird_props = bird.getBoundingClientRect();
        let background = document.querySelector('.background').getBoundingClientRect();
        let score_val = document.querySelector('.score_val');
        let message = document.querySelector('.message');
        
        let game_state = 'Start';
        let img_dy = 0;
        let is_jumping = false;

        // --- Controller Functions (รวม Logic ไว้ที่เดียว) ---

        function startGame() {
            if(game_state != 'Play'){
                document.querySelectorAll('.pipe_sprite').forEach((e) => {
                    e.remove();
                });
                img_dy = 0;
                bird.style.top = '40vh';
                game_state = 'Play';
                message.style.display = 'none';
                score_val.innerHTML = 'Score: 0';
                play();
            }
        }

        function jump() {
            if(game_state === 'Play'){
                img_dy = -5.8; // แรงกระโดด
                // เอียงตัวนกขึ้นเล็กน้อยเวลาโดด (Effect)
                bird.style.transform = 'rotate(-20deg)';
                setTimeout(() => {
                    bird.style.transform = 'rotate(0deg)';
                }, 100);
            }
        }

        // --- Event Listeners (รองรับทั้ง PC และ iPad) ---

        // 1. รองรับการแตะหน้าจอ (Touch)
        document.addEventListener('touchstart', (e) => {
            // e.preventDefault(); // ป้องกันการซูมหรือเลื่อนหน้าจอโดยไม่ตั้งใจ
            if(game_state != 'Play') {
                startGame();
            } else {
                jump();
            }
        });

        // 2. รองรับคีย์บอร์ด (PC)
        document.addEventListener('keydown', (e) => {
            if(e.key == 'Enter' && game_state != 'Play'){
                startGame();
            }
            if((e.key == ' ' || e.key == 'ArrowUp') && game_state == 'Play'){
                jump();
            }
        });

        // 3. รองรับการคลิกเมาส์ (PC Mouse Click)
        document.addEventListener('mousedown', (e) => {
             if(game_state != 'Play') {
                startGame();
            } else {
                jump();
            }
        });


        // --- Main Game Loop ---
        function play(){
            function move(){
                if(game_state != 'Play') return;

                let pipe_sprite = document.querySelectorAll('.pipe_sprite');
                
                // สร้างท่อ
                if(pipe_sprite.length == 0 || pipe_sprite[pipe_sprite.length - 1].getBoundingClientRect().right < window.innerWidth - 300){
                    
                    let pipe_element = document.createElement('div');
                    pipe_element.className = 'pipe_sprite';
                    let pipe_height = Math.floor(Math.random() * 40) + 10;
                    pipe_element.style.height = pipe_height + 'vh';
                    pipe_element.style.left = '100vw';
                    pipe_element.style.top = '0';
                    document.body.appendChild(pipe_element);

                    let pipe_bottom = document.createElement('div');
                    pipe_bottom.className = 'pipe_sprite';
                    pipe_bottom.style.height = (100 - pipe_height - 25) + 'vh'; // ช่องว่าง 25vh
                    pipe_bottom.style.left = '100vw';
                    pipe_bottom.style.bottom = '0';
                    pipe_bottom.style.top = 'auto'; 
                    document.body.appendChild(pipe_bottom);
                }

                pipe_sprite.forEach((element) => {
                    let pipe_sprite_props = element.getBoundingClientRect();
                    bird_props = bird.getBoundingClientRect();

                    if(pipe_sprite_props.right <= 0){
                        element.remove();
                    }else{
                        // เช็คชน
                        if(bird_props.left < pipe_sprite_props.left + pipe_sprite_props.width && 
                           bird_props.left + bird_props.width > pipe_sprite_props.left && 
                           bird_props.top < pipe_sprite_props.top + pipe_sprite_props.height && 
                           bird_props.top + bird_props.height > pipe_sprite_props.top){
                            
                            gameOver();
                            return;
                        }else{
                            // นับคะแนน
                            if(pipe_sprite_props.right < bird_props.left && pipe_sprite_props.right + move_speed >= bird_props.left && element.style.top === '0px'){
                                score_val.innerHTML = 'Score: ' + (parseInt(score_val.innerHTML.split(':')[1]) + 1);
                            }
                            element.style.left = pipe_sprite_props.left - move_speed + 'px';
                        }
                    }
                });
                requestAnimationFrame(move);
            }
            requestAnimationFrame(move);

            function apply_gravity(){
                if(game_state != 'Play') return;
                img_dy = img_dy + gravity;
                
                // ชนขอบบนหรือล่าง
                if(bird_props.top <= 0 || bird_props.bottom >= background.bottom){
                    gameOver();
                    return;
                }
                
                bird.style.top = (bird_props.top + img_dy) + 'px';
                bird_props = bird.getBoundingClientRect();
                requestAnimationFrame(apply_gravity);
            }
            requestAnimationFrame(apply_gravity);
        }

        function gameOver(){
            game_state = 'End';
            message.innerHTML = '<span style="color:red">Game Over</span><br>Tap to Restart';
            message.style.display = 'block';
        }

    </script>
</body>
</html>